package v1

import (
	"context"
	"testing"

	"github.com/stretchr/testify/assert"
	"github.com/stretchr/testify/mock"
)

// MockApplicationServiceHTTPServer implements the interface generated by Kratos
type MockApplicationService struct {
	mock.Mock
}

func (m *MockApplicationService) ChangeApplicationStatus(ctx context.Context, req *ChangeApplicationStatusRequest) (*Application, error) {
	args := m.Called(ctx, req)
	if args.Get(0) == nil {
		return nil, args.Error(1)
	}
	return args.Get(0).(*Application), args.Error(1)
}

func (m *MockApplicationService) CreateApplication(ctx context.Context, req *CreateApplicationRequest) (*Application, error) {
	return nil, nil
}
func (m *MockApplicationService) GetApplication(ctx context.Context, req *GetApplicationRequest) (*Application, error) {
	return nil, nil
}
func (m *MockApplicationService) ListApplications(ctx context.Context, req *ListApplicationsRequest) (*ListApplicationsResponse, error) {
	return nil, nil
}
func (m *MockApplicationService) UpdateApplication(ctx context.Context, req *UpdateApplicationRequest) (*Application, error) {
	return nil, nil
}
func (m *MockApplicationService) GetApplicationAttributes(ctx context.Context, req *GetApplicationAttributesRequest) (*ApplicationAttributes, error) {
	return nil, nil
}
func (m *MockApplicationService) UpsertApplicationAttributes(ctx context.Context, req *UpsertApplicationAttributesRequest) (*ApplicationAttributes, error) {
	return nil, nil
}
func (m *MockApplicationService) UploadApplicationDocument(ctx context.Context, req *UploadApplicationDocumentRequest) (*ApplicationDocument, error) {
	return nil, nil
}
func (m *MockApplicationService) ListApplicationDocuments(ctx context.Context, req *ListApplicationDocumentsRequest) (*ListApplicationDocumentsResponse, error) {
	return nil, nil
}
func (m *MockApplicationService) GetPresignedUrl(ctx context.Context, req *GetPresignedUrlRequest) (*GetPresignedUrlResponse, error) {
	return nil, nil
}

func TestApplicationService_ProtoContract(t *testing.T) {
	m := new(MockApplicationService)
	ctx := context.Background()

	t.Run("Verify ChangeStatus Request Mapping", func(t *testing.T) {
		req := &ChangeApplicationStatusRequest{
			Id:        "018e0000-0000-7000-8000-000000000001",
			NewStatus: "SURVEY",
		}
		expectedResp := &Application{Id: req.Id, Status: "SURVEY"}

		m.On("ChangeApplicationStatus", ctx, req).Return(expectedResp, nil).Once()

		resp, err := m.ChangeApplicationStatus(ctx, req)

		assert.NoError(t, err)
		assert.Equal(t, "SURVEY", resp.Status)
		m.AssertExpectations(t)
	})
}
